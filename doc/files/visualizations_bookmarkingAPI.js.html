<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>visualizations/bookmarkingAPI.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/EEXCESS.model.common.html">EEXCESS.model.common</a></li>
                                <li><a href="../classes/EEXCESS.model.constants.html">EEXCESS.model.constants</a></li>
                                <li><a href="../classes/EEXCESS.model.interests.html">EEXCESS.model.interests</a></li>
                                <li><a href="../classes/EEXCESS.model.languages.html">EEXCESS.model.languages</a></li>
                                <li><a href="../classes/EEXCESS.model.obfuscation.html">EEXCESS.model.obfuscation</a></li>
                                <li><a href="../classes/EEXCESS.model.policy.html">EEXCESS.model.policy</a></li>
                                <li><a href="../classes/EEXCESS.model.profile.html">EEXCESS.model.profile</a></li>
                                <li><a href="../classes/EEXCESS.model.storage.html">EEXCESS.model.storage</a></li>
                                <li><a href="../classes/EEXCESS.model.util-html.html">EEXCESS.model.util-html</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: visualizations/bookmarkingAPI.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
function Bookmarking() {

    var INTERNAL = {};


    INTERNAL.init = function() {

        //chrome.storage.local.remove(&quot;bookmark-dictionary&quot;);
        // Retrieve current bookmark dictionary and keep it in a local variable during execution
        chrome.storage.local.get( &quot;bookmark-dictionary&quot;, function(value){
            BOOKMARKING.Dictionary = ($.isEmptyObject(value)) ? {} : JSON.parse(value[&quot;bookmark-dictionary&quot;]);
            console.log(&#x27;Bookmark dictionary&#x27;);
            console.log(BOOKMARKING.Dictionary);
        } );
    };



    INTERNAL.saveToLocalStorage = function( bookmarkDictionaryCopy ) {

        chrome.storage.local.set({ &quot;bookmark-dictionary&quot; : JSON.stringify( bookmarkDictionaryCopy ) }, function(){
            if(typeof chrome.runtime.lastError == &#x27;undefined&#x27; || chrome.runtime.lastError == &#x27;undefined&#x27;){
                console.log(&#x27;Saving bookmark dictionary in local storage... SUCCESS&#x27;);
            }
            else{
                console.log(&#x27;Saving bookmark dictionary in local storage... FAIL&#x27;);
                console.log( chrome.runtime.lastError );
            }
        });
    };



    INTERNAL.normalizeString = function( text ) {
        return text.replace(&#x27; &#x27;, &#x27;+&#x27;);
    };



/****************************************************************************************************************************************************************************************************/

    var BOOKMARKING = {};


    BOOKMARKING.Dictionary;


    // Creation, Addition

    BOOKMARKING.createBookmark = function( bookmarkName, color ){

        // If bookmark to be added already exists, return false
        if( BOOKMARKING.Dictionary[bookmarkName] != &#x27;undefined&#x27; &amp;&amp; BOOKMARKING.Dictionary[bookmarkName] != null )
            return &quot;bookmark to be added already exists&quot;;

        var timestamp = Date.now();

        BOOKMARKING.Dictionary[bookmarkName] = {
            &#x27;id&#x27; : INTERNAL.normalizeString( bookmarkName ) + &quot;-&quot; + timestamp,
            &#x27;color&#x27; : color || &#x27;#fff&#x27;,
            &#x27;items&#x27; : new Array()
        };

        INTERNAL.saveToLocalStorage( BOOKMARKING.Dictionary );
        return &quot;success&quot;;
    };



    BOOKMARKING.addItemToBookmark = function( bookmarkName, item ){

        if( typeof BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27; || BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27;)
            return &quot;Selected bookmark does not exist&quot;;

        // If item to be added already exists in specified bookmark, return false
        if( BOOKMARKING.Dictionary[bookmarkName].items.getIndexOf(item.id, &#x27;id&#x27;) != -1 )
            return &#x27;Item already exists in &#x27; + bookmarkName;

		item.bookmarked = true; //do to ask cicilia??
		
        BOOKMARKING.Dictionary[bookmarkName].items.push(item);

        INTERNAL.saveToLocalStorage( BOOKMARKING.Dictionary );
        return &#x27;success&#x27;;
    };




    //// Deletion

    BOOKMARKING.deleteBookmark = function( bookmarkName ){

        // If bookmark to be deleted doesn&#x27;t exist, return false
        if( BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27; || BOOKMARKING.Dictionary[bookmarkName] == null )
            return &quot;Selected bookmark does not exist&quot;;

        delete BOOKMARKING.Dictionary[bookmarkName];

        INTERNAL.saveToLocalStorage( BOOKMARKING.Dictionary );
        return &quot;success&quot;;
    };


    BOOKMARKING.deleteAllBookmarks = function(){
        BOOKMARKING.Dictionary = {};
        INTERNAL.saveToLocalStorage( BOOKMARKING.Dictionary );
        return &quot;success&quot;;
    };



    BOOKMARKING.deleteItemFromBookmark = function( itemId, bookmarkName ){
        // If item to be deleted doesn&#x27;t exist in specified bookmark, return false
        var index = BOOKMARKING.Dictionary[bookmarkName].items.getIndexOf(itemId, &#x27;id&#x27;);
        if(index == -1)
            return &quot;Selected item does not exist&quot;;

        BOOKMARKING.Dictionary[bookmarkName].items.splice(index, 1);

        INTERNAL.saveToLocalStorage( BOOKMARKING.Dictionary );
        return &quot;success&quot;;
    };



    BOOKMARKING.deleteItemFromAllBookmarks = function( itemId ){

        var entries = Object.keys(BOOKMARKING.Dictionary);

        entries.forEach(function( entry ){
            var index = BOOKMARKING.Dictionary[entry].items.getIndexOf(itemId, &#x27;id&#x27;);
            if(index != -1)
                BOOKMARKING.Dictionary[entry].items.splice(index, 1);
        });

        INTERNAL.saveToLocalStorage( BOOKMARKING.Dictionary );
        return &quot;success&quot;;
    };



    //// Retrieval


    BOOKMARKING.getAllBookmarks = function(){
        return BOOKMARKING.Dictionary;
    };


    BOOKMARKING.getAllBookmarkNamesAndColors = function(){

        var bookmarkNamesAndColors = [];
        var entries = Object.keys(BOOKMARKING.Dictionary);

        entries.forEach(function(entry){
            bookmarkNamesAndColors.push({
                &#x27;bookmark-name&#x27; : entry,
                &#x27;color&#x27; : BOOKMARKING.Dictionary[entry].color
            });
        });

        return bookmarkNamesAndColors;
    };



    BOOKMARKING.getBookmarsDictionary = function( bookmarkName ) {

        if(typeof BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27; || BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27; || BOOKMARKING.Dictionary[bookmarkName] == null)
            return &quot;Error retrieving bookmark&quot;;

        return BOOKMARKING.Dictionary[bookmarkName];
    };



    BOOKMARKING.getAllBookmarkedItemsInArray = function( bookmarkName ) {

        if(BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27; || BOOKMARKING.Dictionary[bookmarkName] == null || typeof BOOKMARKING.Dictionary[bookmarkName] == &#x27;undefined&#x27;)
            return &quot;Error retrieving bookmark&quot;;

        var bookmarkedItems = [];

        BOOKMARKING.Dictionary[bookmarkName].items.forEach(function(item){

            var obj = item;
            obj[&#x27;bookmark-name&#x27;] = bookmarkName;
            obj[&#x27;bookmark-id&#x27;] = BOOKMARKING.Dictionary[bookmarkName].id;
            obj[&#x27;color&#x27;] = BOOKMARKING.Dictionary[bookmarkName].color;
        });

        return bookmarkedItems;
    };



    /**
    *   @param attrValues: array or single item value (id or name) for which all the corresponding bookmarks want to be retrieved
    *   @param attrName: name of the attribute to be used for comparison
    *   return: dictionary whose entries correspond to the values included in attrValues that are actually bookmarked.
    *       Each entry contains an array &#x27;bookmarked&#x27;, where each item consists of an object specifying bookmark name and id, plus the query within which the item was bookmarked&#x27;
    *       An item representes a recommended documents that can be bookmarked in more than one bookmark (but only once in each bookmark). Hence &#x27;bookmarked&#x27;
    *       has as many elements as the # of bookmarkswhere an item was included.
    *
    **/
    BOOKMARKING.getBookmarkedItemsByAttr = function( attrValues, attrName ){

        valuesArray = (Array.isArray(attrValues)) ? attrValues : [attrValues];

        var bookmarkedItems = {};
        var dictionaryEntries = Object.keys(BOOKMARKING.Dictionary);

        dictionaryEntries.forEach(function(entry){
            BOOKMARKING.Dictionary[entry].items.forEach(function(item){

                if( valuesArray.indexOf(item[attrName]) != -1 ){

                    var itemEntry = item[attrName];
                    if(typeof bookmarkedItems[itemEntry] == &#x27;undefined&#x27; || bookmarkedItems[itemEntry] == &#x27;undefined&#x27;){
                        // bookmarkedItems doesn&#x27;t contain an entry with the value item[attrName] yet. Add new entry
                        bookmarkedItems[itemEntry] = { &#x27;bookmarked&#x27; : new Array() };
                    }

                    bookmarkedItems[itemEntry].bookmarked.push({
                        &#x27;bookmark-name&#x27; : entry,
                        &#x27;bookmark-id&#x27; : BOOKMARKING.Dictionary[entry].id,
                        &#x27;color&#x27; : BOOKMARKING.Dictionary[entry].color,
                    });
                }
            });
        });

        // If the param attrValues is an array, return the whole dictionary contained in bookmarkedItems, otherwise only the content for the only entry in bookmarkedItems
        if(Array.isArray(attrValues)) return bookmarkedItems;
        return bookmarkedItems[attrValues];
    };





/****************************************************************************************************************************************************************************************************/


    var EXTERNAL = {

        init : function(){
            INTERNAL.init();
        },


        // Creation, Addition
        createBookmark : function( bookmarkName, color ){
            return BOOKMARKING.createBookmark(bookmarkName, color );
        },

        addItemToBookmark : function( bookmarkName, item ){
            return BOOKMARKING.addItemToBookmark( bookmarkName, item );
        },


        // Deletion
        deleteBookmark : function( bookmarkName ){
            return BOOKMARKING.deleteBookmark( bookmarkName );
        },

        deleteAllBookmarks : function(){
            return BOOKMARKING.deleteAllBookmarks();
        },

        deleteItemFromBookmark : function( itemId, bookmarkName ){
            return BOOKMARKING.deleteItemFromBookmark( itemId, bookmarkName );
        },

        deleteItemFromAllBookmarks : function(itemId){
            return BOOKMARKING.deleteItemFromAllBookmarks(itemId);
        },


        // Retrieval
        getAllBookmarks : function(){
            return BOOKMARKING.getAllBookmarks();
        },

        getAllBookmarkNamesAndColors : function(){
            return BOOKMARKING.getAllBookmarkNamesAndColors();
        },

        getBookmarsDictionary : function(bookmarkName){
            return BOOKMARKING.getBookmarsDictionary(bookmarkName);
        },

        getAllBookmarkedItemsInArray : function(bookmarkName) {
            return BOOKMARKING.getAllBookmarkedItemsInArray(bookmarkName)  ;
        },

        getBookmarkedItemsById : function(itemId) {
             return BOOKMARKING.getBookmarkedItemsByAttr( itemId, &#x27;id&#x27; );
        },

        getBookmarkedItemsByTitle : function(itemName) {
             return BOOKMARKING.getBookmarkedItemsByAttr( itemName, &#x27;title&#x27; );
        },


        // Testing
        testBookmarking : function(){

            EXTERNAL.deleteAllBookmarks();

            console.log(EXTERNAL.createBookmark( &#x27;bububu&#x27;, &#x27;#F00&#x27; ));
            console.log(EXTERNAL.createBookmark( &#x27;blahblah&#x27;, &#x27;#0F0&#x27; ));
            console.log(EXTERNAL.createBookmark( &#x27;interesting&#x27;));
            console.log(EXTERNAL.createBookmark( &#x27;bububu&#x27;, &#x27;#00F&#x27; ));

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;GET ALL BOOKMARK NAMES&quot;);
            console.log(JSON.stringify(EXTERNAL.getAllBookmarkNamesAndColors()));

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;add items to bookmarks&quot;);
            console.log(EXTERNAL.addItemToBookmark(&quot;bububu&quot;, &quot;Gender Pay Gap in the 20th Century&quot;, &quot;doc1346923649898&quot;, &quot;pay gap&quot;));
            console.log(EXTERNAL.addItemToBookmark(&quot;bububu&quot;, &quot;Women in industry&quot;, &quot;dfff3y4237498724723947923&quot;, &quot;women workforce&quot;));
            console.log(EXTERNAL.addItemToBookmark(&quot;blahblah&quot;, &quot;Machine Learning for Dummies&quot;, &quot;ghgug65467468768&quot;, &quot;machine learning&quot;));
            console.log(EXTERNAL.addItemToBookmark(&quot;blahblah&quot;, &quot;Women in industry&quot;, &quot;dfff3y4237498724723947923&quot;, &quot;women workforce&quot;));
            console.log(EXTERNAL.addItemToBookmark(&quot;bububu&quot;, &quot;Gender Pay Gap in the 20th Century&quot;, &quot;doc1346923649898&quot;, &quot;pay gap&quot;));

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;GET ALL BOOKMARKS (items loaded)&quot;);
            console.log(EXTERNAL.getAllBookmarks());

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;get bookmarks in object for &lt;bububu&gt;&quot;);
            console.log(EXTERNAL.getBookmarsDictionary(&quot;bububu&quot;));
            console.log(&quot;get bookmarks in object for &lt;blahblah&gt;&quot;);
            console.log(EXTERNAL.getBookmarsDictionary(&quot;blahblah&quot;));
            console.log(&quot;get bookmarks in object for &lt;lalala&gt; (doesn&#x27;t exist)&quot;);
            console.log(EXTERNAL.getBookmarsDictionary(&quot;lalala&quot;));

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;get bookmarks in array for &lt;bububu&gt;&quot;);
            console.log(EXTERNAL.getAllBookmarkedItemsInArray(&quot;bububu&quot;));
            console.log(&quot;get bookmarks in array for &lt;blahblah&gt;&quot;);
            console.log(EXTERNAL.getAllBookmarkedItemsInArray(&quot;blahblah&quot;));
            console.log(&quot;get bookmarks in array for &lt;lalala&gt; (doesn&#x27;t exist)&quot;);
            console.log(EXTERNAL.getAllBookmarkedItemsInArray(&quot;lalala&quot;));

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;get bookmarks by item id &lt;doc1346923649898&gt; (1 item)&quot;);
            console.log(EXTERNAL.getBookmarkedItemsByItemId(&quot;doc1346923649898&quot;));
            console.log(&quot;get bookmarks by item id &lt;dfff3y4237498724723947923&gt; (2 items)&quot;);
            console.log(EXTERNAL.getBookmarkedItemsByItemId(&quot;dfff3y4237498724723947923&quot;));
            console.log(&quot;get bookmarks by item id &lt;ffffffff&gt; (doesn&#x27;t exist)&quot;);
            console.log(EXTERNAL.getBookmarkedItemsByItemId(&quot;ffffffff&quot;));
            console.log(&quot;get bookmarks by item id for array [doc1346923649898, dfff3y4237498724723947923, ffffffff]&quot;);
            console.log(EXTERNAL.getBookmarkedItemsByItemId([&quot;doc1346923649898&quot;, &quot;dfff3y4237498724723947923&quot;, &quot;ffffffff&quot;]));

            /*
            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;delete item with id &lt;dfff3y4237498724723947923&gt; from bookmark &lt;bububu&gt;&quot;);
            console.log(EXTERNAL.deleteItemFromBookmark(&quot;dfff3y4237498724723947923&quot;, &quot;bububu&quot;));
            console.log(JSON.stringify(EXTERNAL.getAllBookmarks()));

            // Re-add deleted items to execute next test
            EXTERNAL.addItemToBookmark(&quot;bububu&quot;, &quot;Women in industry&quot;, &quot;dfff3y4237498724723947923&quot;, &quot;women workforce&quot;);

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;delete item with id &lt;dfff3y4237498724723947923&gt; from all bookmarks&quot;);
            console.log(EXTERNAL.deleteItemFromAllBookmarks(&quot;dfff3y4237498724723947923&quot;));
            console.log(JSON.stringify(EXTERNAL.getAllBookmarks()));

            console.log(&quot;*****************************************************************************************&quot;);
            chrome.storage.sync.get( &quot;bookmark-dictionary&quot;, function(value){
                console.log(&quot;Read local storage&quot;);
                console.log(value);
            });

            console.log(&quot;*****************************************************************************************&quot;);
            console.log(&quot;DELETE ALL BOOKMARKS&quot;);
            console.log(EXTERNAL.deleteAllBookmarks());
            console.log(EXTERNAL.getAllBookmarks());
            */
        }

    };



    return EXTERNAL;

}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
