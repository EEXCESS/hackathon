<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>privacy/interests.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/EEXCESS.model.common.html">EEXCESS.model.common</a></li>
                                <li><a href="../classes/EEXCESS.model.constants.html">EEXCESS.model.constants</a></li>
                                <li><a href="../classes/EEXCESS.model.interests.html">EEXCESS.model.interests</a></li>
                                <li><a href="../classes/EEXCESS.model.languages.html">EEXCESS.model.languages</a></li>
                                <li><a href="../classes/EEXCESS.model.obfuscation.html">EEXCESS.model.obfuscation</a></li>
                                <li><a href="../classes/EEXCESS.model.policy.html">EEXCESS.model.policy</a></li>
                                <li><a href="../classes/EEXCESS.model.profile.html">EEXCESS.model.profile</a></li>
                                <li><a href="../classes/EEXCESS.model.storage.html">EEXCESS.model.storage</a></li>
                                <li><a href="../classes/EEXCESS.model.util-html.html">EEXCESS.model.util-html</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: privacy/interests.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Provides methods to manage the interests. 
 * @class interests
 */

/**
 * @method getInterestInputs
 * @returns {ListNode} list of interest inputs.
 */
function getInterestInputs(){
	return document.getElementsByClassName(CLASS_INTEREST);
}

/**
 * Initializes the interests with the values from the data store. 
 * It generates the HTML code, initializes the TagIt fields, adds the listeners and initializes the buttons.  
 * @method initInterests
 */
function initInterests(){ 
	var interests = getStoredJson(INTERESTS); 
	var interestsElement = document.getElementById(INTERESTS);
	var code = &quot;&quot;;
	for (var i = 0 ; i &lt; interests.length ; i++){
		code = code + generateCodeInterest(i);
		interestsElement.innerHTML = code;
	}
	var interestElements = getInterestInputs();
	for (var i = 0 ; i &lt; interestElements.length ; i++){
		var interestElement = interestElements[i];
		var interestId = interestElement.getAttribute(&quot;id&quot;); 
		initInterest(interestId);
		createInterestListener(interestId);
	}
	// Initialize the buttons
	for (var i = 0 ; i &lt; interests.length ; i++){
		var policyElement = document.getElementById(INTEREST_POLICY + i);
		initButtonGroup(policyElement);
	}
}

/**
 * Adds an interest: generates the HTML code, adds the listeners, initializes the buttons, saves the interests and update the listeners. 
 * @method addNewInterest
 */
function addNewInterest(){
	var interestsElement = document.getElementById(INTERESTS);
	var nbInterests = interestsElement.children.length + 1; // +1 to consider the new one
	var code = &quot;&quot;;
	for (var i = 0 ; i &lt; nbInterests ; i++){
		code = code + generateCodeInterest(i);
	}
	interestsElement.innerHTML = code;
	var interestElements = getInterestInputs();
	for (var i = 0 ; i &lt; interestElements.length ; i++){
		// Initialise the interests
		var interestElement = interestElements[i];
		var interestId = interestElement.getAttribute(&quot;id&quot;);
		initInterest(interestId);
		createInterestListener(interestId);
		// Initialise the buttons
		var policyElement = document.getElementById(INTEREST_POLICY + i);
		initButtonGroup(policyElement);
		
	}	
	// Save all the interests
	saveInterests();
	// Add listeners
	updateInterestListeners();
}

/**
 * Initializes an interest (instantiate the TagIt field).  
 * @param {String} interestId identifier of an interest.
 * @method initInterest
 */
function initInterest(interestId) {
	$(&quot;#&quot; + interestId).tagit();
	var index = extractEndingNumber(interestId);
	var interests = getStoredJson(INTERESTS);
	if (interests.length &gt; index){
		var interest = interests[index]; 
		for (var i = 0 ; i &lt; interest.length ; i++){
			$(&quot;#&quot; + interestId).tagit(&quot;createTag&quot;, interest[i]);
		}
	}
}

/**
 * Create the listeners for a TagIt field. 
 * @param {String} interestId identifier of an interest.
 * @method createInterestListener
 */
function createInterestListener(interestId) {
	$(&quot;#&quot; + interestId).tagit({
		removeConfirmation: true,
    	afterTagAdded: function(event, ui) {
	    	if (!ui.duringInitialization) {
	    		var interestElement = document.getElementById(interestId);
	    		elementListener(interestElement, CLASS_INTEREST);
	            saveInterests();
	        }
    	}, 
    	afterTagRemoved: function(event, ui) {
    		var interestElement = document.getElementById(interestId);
    		elementListener(interestElement, CLASS_INTEREST);
    		saveInterests();
        }
    });
}

/**
 * Updates the listeners for all the interests: 
 * TagIt field listeners, listener for the removal of an interest, and buttons listeners. 
 * @method updateInterestListeners
 */
function updateInterestListeners(){
	var interestElements = getInterestInputs();
	for (var i = 0 ; i &lt; interestElements.length ; i++){
		var interestElement = interestElements[i];
		var interestId = interestElement.getAttribute(&quot;id&quot;);
		var interestIdNum = extractEndingNumber(interestId); 
		createInterestListener(interestId);
		var removeInterestElement = document.getElementById(REMOVE_INTEREST + interestIdNum);
		removeInterestElement.addEventListener(&quot;click&quot;, function(){ removeInterestListener(this); }); 
		var policyInterestElement = document.getElementById(INTEREST_POLICY + interestIdNum);
		for (var j = 0 ; j &lt; policyInterestElement.children.length ; j++){
			var button = policyInterestElement.children[j];
			button.addEventListener(&quot;click&quot;, function(){ policyButtonListener(this); });
		}
	}
}

/**
 * Generate the HTML code to insert a new interest. 
 * @param {Integer} index Index of the interest to add.  
 * @returns {String} HTML code. 
 * @method generateCodeInterest
 */
function generateCodeInterest(index){ 
	var code = 	&#x27;&lt;div id=&quot;&#x27; + INTEREST + index + &#x27;&quot; class=&quot;row&quot;&gt;\n&#x27;;
	code += 	&#x27;	&lt;div class=&quot;panel-body&quot;&gt;\n&#x27;;
	code += 	&#x27;		&lt;div class=&quot;col-md-6&quot;&gt;\n&#x27;;
	code += 	&#x27;			&lt;div class=&quot;row&quot;&gt;\n&#x27;;
	code += 	&#x27;				&lt;div class=&quot;col-md-1&quot;&gt;\n&#x27;;
	code += 	&#x27;					&lt;div class=&quot;panel-body&quot;&gt;\n&#x27;;
	code += 	&#x27;						&lt;a id=&quot;&#x27; + REMOVE_INTEREST + index +&#x27;&quot; class=&quot;&#x27; + REMOVE_INTEREST + &#x27;&quot; style=&quot;color: red;&quot; href=&quot;#x&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-remove&quot;&gt;&lt;/span&gt;&lt;/a&gt;\n&#x27;;
	code += 	&#x27;					&lt;/div&gt;\n&#x27;;
	code += 	&#x27;				&lt;/div&gt;\n&#x27;;
	code += 	&#x27;				&lt;div class=&quot;col-md-11 row&quot;&gt;\n&#x27;;
	code += 	&#x27;					&lt;div class=&quot;input-group&quot;&gt;\n&#x27;;
	code += 	&#x27;						&lt;ul id=&quot;&#x27; + INTEREST_INPUT + index + &#x27;&quot; class=&quot;&#x27; + CLASS_INTEREST + &#x27;&quot;&gt;&lt;/ul&gt;\n&#x27;;
	code += 	&#x27;					&lt;/div&gt;\n&#x27;;
	code += 	&#x27;				&lt;/div&gt;\n&#x27;;
	code += 	&#x27;			&lt;/div&gt;\n&#x27;;
	code += 	&#x27;		&lt;/div&gt;\n&#x27;;
	code += 	&#x27;		&lt;div id=&quot;&#x27; + INTEREST_POLICY + index + &#x27;&quot; class=&quot;btn-group col-md-2&quot; role=&quot;group&quot;&gt;\n&#x27;;
	code += 	&#x27;			&lt;button type=&quot;button&quot;  class=&quot;btn &#x27; + BUTTON_STYLE_GREY + &#x27; &#x27; + CLASS_BUTTON + &#x27;&quot; &#x27; + PARENT_ID + &#x27;=&quot;&#x27; + INTEREST_POLICY + index + &#x27;&quot;&gt;Hidden&lt;/button&gt;\n&#x27;;
	code += 	&#x27;			&lt;button type=&quot;button&quot;  class=&quot;btn &#x27; + BUTTON_STYLE_GREY + &#x27; &#x27; + CLASS_BUTTON + &#x27;&quot; &#x27; + PARENT_ID + &#x27;=&quot;&#x27; + INTEREST_POLICY + index + &#x27;&quot;&gt;Disclosed&lt;/button&gt;\n&#x27;;
	code += 	&#x27;		&lt;/div&gt;&#x27;;
	code += 	&#x27;		&lt;div class=&quot;col-md-4&quot;&gt;Value shared with the system: \n&#x27;;
	code += 	&#x27;			&lt;span id=&quot;&#x27; + INTEREST_DISPLAY + index + &#x27;&quot;&gt;&lt;/span&gt;\n&#x27;;
	code += 	&#x27;		&lt;/div&gt;\n&#x27;;	
	code += 	&#x27;	&lt;/div&gt;\n&#x27;;	
	code += 	&#x27;&lt;/div&gt;\n&#x27;;
	return code;
}

/**
 * Saves all the interests: extract the values from the form and store it in the data store. 
 * @method saveInterests
 */
function saveInterests(){
	var interestElements = getInterestInputs();
	var interests = [];
	for (var i = 0 ; i &lt; interestElements.length ; i++){
		var interestElement = interestElements[i];
		var interestId = interestElement.getAttribute(&quot;id&quot;);
		var array = $(&quot;#&quot; + interestId).tagit(&quot;assignedTags&quot;);
		if ((array != null) &amp;&amp; (array.length != 0)){
			interests.push(array);
		}
	}
	storeValue(INTERESTS, JSON.stringify(interests));
}

/**
 * Adds a topic to an interest (added only if it&#x27;s not already contained).  
 * @param {Array} interests Array of interests. 
 * @param {String} interestId Identifier of the interest to be updated. 
 * @param {String} label Label of the new topic. 
 * @returns {Array} Array of interests containing &quot;label&quot;. 
 * @method addTopic
 */
function addTopic(interests, interestId, label){
	var index = &quot;&quot;;
	if (endsWithNumber(interestId)){
		index = extractEndingNumber(interestId); 
	}
	var interest = interests[index];
	if (interest == null){
		interest = [];
	}
	if (interest.indexOf(label) == -1){
		interest.push(label);
		interests[index] = interest;
	}
	return interests;
}

/**
 * Removes a topic for an interest. 
 * @param {Array} interests Array of interests.  
 * @param {String} interestId Identifier of the interest to be updated. 
 * @param {String} label Label of the topic to be removed.  
 * @returns {Array} Array of interests without &quot;label&quot;. 
 * @method removeTopic
 */
function removeTopic(interests, interestId, label){
	var index = extractEndingNumber(interestId);
	var interest = interests[index];
	if (interest != null){
		interest.splice(interest.indexOf(label), 1);
		if (interest.length != 0){
			interests[index] = interest;
		} else {
			interests.splice(index, 1);
		}
	}
	return interests;
}

/**
 * Removes the listener assigned to a link. 
 * This method is used when an interest is removed to make sure the removal is done properly. 
 * It resets the policy level, remove the HTML code, and save the interests. 
 * @param link
 * @method removeInterestListener
 */
function removeInterestListener(link){
	resetElementPolicy(link, INTEREST_POLICY, DEFAULT_POLICY_LEVEL);
	removeElement(link, INTEREST);
	saveInterests();
}

/**
 * Listener invoked when an interest must be added. 
 * @method addInterestListener
 */
function addInterestListener(){ 
	addNewInterest(); 
}
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
