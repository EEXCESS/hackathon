<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>background/corpus_webWorker.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/EEXCESS.model.common.html">EEXCESS.model.common</a></li>
                                <li><a href="../classes/EEXCESS.model.constants.html">EEXCESS.model.constants</a></li>
                                <li><a href="../classes/EEXCESS.model.interests.html">EEXCESS.model.interests</a></li>
                                <li><a href="../classes/EEXCESS.model.languages.html">EEXCESS.model.languages</a></li>
                                <li><a href="../classes/EEXCESS.model.obfuscation.html">EEXCESS.model.obfuscation</a></li>
                                <li><a href="../classes/EEXCESS.model.policy.html">EEXCESS.model.policy</a></li>
                                <li><a href="../classes/EEXCESS.model.profile.html">EEXCESS.model.profile</a></li>
                                <li><a href="../classes/EEXCESS.model.storage.html">EEXCESS.model.storage</a></li>
                                <li><a href="../classes/EEXCESS.model.util-html.html">EEXCESS.model.util-html</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: background/corpus_webWorker.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var EEXCESS = EEXCESS || {};

/**
 * Represents a token.
 * 
 * By default, the type is set to &#x27;w&#x27;, if no type is provided. This corresponds
 * to a regular word.
 * 
 * @param {String} token
 * @param {String} parent
 * @param {String} type
 */
EEXCESS.Token = function(token, parent, type) {
    this.token = token;
    this.parent = parent;
    this.type = type || &#x27;w&#x27;;
};

/**
 * Returns an array of stopwords for the provided language if the specified
 * language is supported.
 * 
 * Currently, only english and german are supported
 * 
 * @param {String} language country code of provided language
 * @returns {Array} array of stopwords
 */
EEXCESS.stopwords = function(language) {
    // TODO: stopwords to DB / learn stopwords ?
    var languages = {};
    languages[&#x27;en&#x27;] = [&quot;a&quot;, &quot;about&quot;, &quot;above&quot;, &quot;after&quot;, &quot;again&quot;, &quot;against&quot;,
        &quot;all&quot;, &quot;am&quot;, &quot;an&quot;, &quot;and&quot;, &quot;any&quot;, &quot;are&quot;, &quot;aren&#x27;t&quot;, &quot;as&quot;, &quot;at&quot;, &quot;be&quot;, &quot;for&quot;, &quot;edit&quot;,
        &quot;because&quot;, &quot;been&quot;, &quot;before&quot;, &quot;by&quot;, &quot;from&quot;, &quot;had&quot;, &quot;hadn&#x27;t&quot;, &quot;has&quot;,
        &quot;hasn&#x27;t&quot;, &quot;have&quot;, &quot;haven&#x27;t&quot;, &quot;having&quot;, &quot;he&quot;, &quot;he&#x27;d&quot;, &quot;he&#x27;ll&quot;, &quot;he&#x27;s&quot;,
        &quot;her&quot;, &quot;here&quot;, &quot;here&#x27;s&quot;, &quot;hers&quot;, &quot;herself&quot;, &quot;him&quot;, &quot;himself&quot;, &quot;his&quot;,
        &quot;how&quot;, &quot;how&#x27;s&quot;, &quot;i&quot;, &quot;i&#x27;d&quot;, &quot;i&#x27;ll&quot;, &quot;i&#x27;m&quot;, &quot;i&#x27;ve&quot;, &quot;if&quot;, &quot;in&quot;, &quot;into&quot;,
        &quot;is&quot;, &quot;isn&#x27;t&quot;, &quot;it&quot;, &quot;it&#x27;s&quot;, &quot;its&quot;, &quot;itself&quot;, &quot;let&#x27;s&quot;, &quot;me&quot;, &quot;more&quot;,
        &quot;most&quot;, &quot;mustn&#x27;t&quot;, &quot;my&quot;, &quot;myself&quot;, &quot;no&quot;, &quot;nor&quot;, &quot;not&quot;, &quot;of&quot;, &quot;off&quot;,
        &quot;on&quot;, &quot;once&quot;, &quot;only&quot;, &quot;or&quot;, &quot;other&quot;, &quot;ought&quot;, &quot;our&quot;, &quot;ours&quot;,
        &quot;ourselves&quot;, &quot;out&quot;, &quot;over&quot;, &quot;own&quot;, &quot;same&quot;, &quot;shan&#x27;t&quot;, &quot;she&quot;, &quot;she&#x27;d&quot;,
        &quot;she&#x27;ll&quot;, &quot;she&#x27;s&quot;, &quot;should&quot;, &quot;shouldn&#x27;t&quot;, &quot;so&quot;, &quot;some&quot;, &quot;such&quot;, &quot;than&quot;,
        &quot;that&quot;, &quot;that&#x27;s&quot;, &quot;the&quot;, &quot;their&quot;, &quot;theirs&quot;, &quot;them&quot;, &quot;themselves&quot;,
        &quot;then&quot;, &quot;there&quot;, &quot;there&#x27;s&quot;, &quot;these&quot;, &quot;they&quot;, &quot;they&#x27;d&quot;, &quot;they&#x27;ll&quot;,
        &quot;they&#x27;re&quot;, &quot;they&#x27;ve&quot;, &quot;this&quot;, &quot;those&quot;, &quot;through&quot;, &quot;to&quot;, &quot;too&quot;, &quot;under&quot;,
        &quot;until&quot;, &quot;up&quot;, &quot;very&quot;, &quot;was&quot;, &quot;wasn&#x27;t&quot;, &quot;we&quot;, &quot;we&#x27;d&quot;, &quot;we&#x27;ll&quot;, &quot;we&#x27;re&quot;,
        &quot;we&#x27;ve&quot;, &quot;were&quot;, &quot;weren&#x27;t&quot;, &quot;what&quot;, &quot;what&#x27;s&quot;, &quot;when&quot;, &quot;when&#x27;s&quot;, &quot;where&quot;,
        &quot;where&#x27;s&quot;, &quot;which&quot;, &quot;while&quot;, &quot;who&quot;, &quot;who&#x27;s&quot;, &quot;whom&quot;, &quot;why&quot;, &quot;why&#x27;s&quot;,
        &quot;with&quot;, &quot;won&#x27;t&quot;, &quot;would&quot;, &quot;wouldn&#x27;t&quot;, &quot;you&quot;, &quot;you&#x27;d&quot;, &quot;you&#x27;ll&quot;,
        &quot;you&#x27;re&quot;, &quot;you&#x27;ve&quot;, &quot;your&quot;, &quot;yours&quot;, &quot;yourself&quot;, &quot;yourselves&quot;
    ];
    languages[&quot;de&quot;] = [&quot;aber&quot;, &quot;als&quot;, &quot;am&quot;, &quot;an&quot;, &quot;auch&quot;, &quot;auf&quot;, &quot;aus&quot;, &quot;bei&quot;,
        &quot;bin&quot;, &quot;bis&quot;, &quot;bist&quot;, &quot;da&quot;, &quot;dadurch&quot;, &quot;daher&quot;, &quot;darum&quot;, &quot;das&quot;, &quot;daß&quot;,
        &quot;dass&quot;, &quot;dein&quot;, &quot;deine&quot;, &quot;dem&quot;, &quot;den&quot;, &quot;der&quot;, &quot;des&quot;, &quot;dessen&quot;,
        &quot;deshalb&quot;, &quot;die&quot;, &quot;dies&quot;, &quot;dieser&quot;, &quot;dieses&quot;, &quot;doch&quot;, &quot;dort&quot;, &quot;du&quot;,
        &quot;durch&quot;, &quot;ein&quot;, &quot;eine&quot;, &quot;einem&quot;, &quot;einen&quot;, &quot;einer&quot;, &quot;eines&quot;, &quot;er&quot;, &quot;es&quot;,
        &quot;euer&quot;, &quot;eure&quot;, &quot;für&quot;, &quot;hatte&quot;, &quot;hatten&quot;, &quot;hattest&quot;, &quot;hattet&quot;, &quot;hier&quot;,
        &quot;hinter&quot;, &quot;ich&quot;, &quot;ihr&quot;, &quot;ihre&quot;, &quot;im&quot;, &quot;in&quot;, &quot;ist&quot;, &quot;ja&quot;, &quot;jede&quot;,
        &quot;jedem&quot;, &quot;jeden&quot;, &quot;jeder&quot;, &quot;jedes&quot;, &quot;jener&quot;, &quot;jenes&quot;, &quot;jetzt&quot;, &quot;kann&quot;,
        &quot;kannst&quot;, &quot;können&quot;, &quot;könnt&quot;, &quot;machen&quot;, &quot;mein&quot;, &quot;meine&quot;, &quot;mit&quot;, &quot;muß&quot;,
        &quot;mußt&quot;, &quot;musst&quot;, &quot;müssen&quot;, &quot;müßt&quot;, &quot;nach&quot;, &quot;nachdem&quot;, &quot;nein&quot;, &quot;nicht&quot;,
        &quot;nun&quot;, &quot;oder&quot;, &quot;seid&quot;, &quot;sein&quot;, &quot;seine&quot;, &quot;sich&quot;, &quot;sie&quot;, &quot;sind&quot;, &quot;soll&quot;, &quot;siehe&quot;,
        &quot;sollen&quot;, &quot;sollst&quot;, &quot;sollt&quot;, &quot;sonst&quot;, &quot;soweit&quot;, &quot;sowie&quot;, &quot;und&quot;, &quot;unser&quot;,
        &quot;unsere&quot;, &quot;unter&quot;, &quot;vom&quot;, &quot;von&quot;, &quot;vor&quot;, &quot;wann&quot;, &quot;warum&quot;, &quot;was&quot;,
        &quot;weiter&quot;, &quot;weitere&quot;, &quot;wenn&quot;, &quot;wer&quot;, &quot;werde&quot;, &quot;werden&quot;, &quot;werdet&quot;,
        &quot;weshalb&quot;, &quot;wie&quot;, &quot;wieder&quot;, &quot;wieso&quot;, &quot;wir&quot;, &quot;wird&quot;, &quot;wirst&quot;, &quot;wo&quot;,
        &quot;woher&quot;, &quot;wohin&quot;, &quot;wurde&quot;, &quot;zu&quot;, &quot;zum&quot;, &quot;zur&quot;, &quot;über&quot;
    ];
    if (typeof languages[language] !== &#x27;undefined&#x27;) {
        return languages[language];
    } else {
        return [];
    }
};


/**
 * Creates a token out of the provided text.
 * Removes leading/trailing whitespaces and special characters.
 * Tokens, consisting of a single character after this process are discarded.
 * For urls, tokens with the type &#x27;u&#x27; are created and for email-adresses,
 * tokens with the type &#x27;e&#x27; respectively.
 * 
 * @param {String} text the text from which to create the token
 * @param {String} parent the parent element of the text
 * @returns {EEXCESS.Token} the created token
 */
EEXCESS.createToken = function(text, parent) {
    // to lower case
    text = text.toLowerCase();
    // remove leading/trailing whitespace
    text = text.replace(/^\s+|\s+$/g, &#x27;&#x27;);
    // url?
    if (text.search(/(http|https):\/\/[\w]*/) !== -1) {
        return new this.Token(text, parent, &#x27;u&#x27;);
    }
    // email?
    if (text.search(/[\w]+@[\w]+/) !== -1) {
        return new this.Token(text, parent, &#x27;e&#x27;);
    }
    // remove everything with digits in it
    text = text.replace(/.*\d.*/g, &#x27;&#x27;);
    // token has at least 2 chars
    if (text.length &gt; 1) {
        return new this.Token(text, parent, &#x27;w&#x27;);
    } else {
        return null;
    }
};

/**
 * Tokenizes the provided text
 * 
 * @param {String} text the text to tokenize
 * @param {String} parent the parent element of the text
 * @param {String} language country code of the text&#x27;s language
 * @returns {Array} tokenized text
 */
EEXCESS.tokenize = function(text, parent, language) {
    var tokens = [];

    if (this.stopwords(language).indexOf(text.trim().toLowerCase()) !== -1) {
        text = &#x27;&#x27;;
    }
    // remove stopwords
//    var innerRegexp = this.stopwords(language).join(&#x27;\\b|[^a-zA-ZäöüßÄÖÜ]&#x27;);
//    var regexp = new RegExp(&#x27;[^a-zA-ZäöüßÄÖÜ]&#x27; + innerRegexp + &#x27;\\b&#x27;, &#x27;gi&#x27;);
//    text = text.replace(regexp, &#x27;&#x27;);

    // tokenize
    var words = text.match(/([äöüÄÖÜß\w-_]{3,})/g);
    if (words) {
        for (var i = 0, len = words.length; i &lt; len; i++) {
            var word = words[i].trim();
            if (this.stopwords(language).indexOf(word.toLowerCase()) === -1) {
                // TODO: save position in the text? (stopwors already removed, thuss not really correct)
                var token = this.createToken(words[i].trim(), parent);
                if (token !== null) {
                    tokens.push(token);
                }
            }
        }
    }
    return tokens;
};

/**
 * Represents a corpus of tokens
 */
EEXCESS.Corpus = function() {
};

/**
 * Function updates the amount of tokens belonging to the provided parent
 * 
 * If no entry exists for the token in the corpus, a new entry is created along 
 * with the corresponding parent entry. If the token is present, but the parent
 * entry not, the latter is added. Otherwise, the amount of tokens corresponding
 * to the given parent entry is incremented by 1. In all cases, the overall 
 * amount of occurrences of the provided token is incremented by 1.
 * @param {String} token the token for which to increment the amount
 * @param {String} parent the token&#x27;s parent for which to increment the amount
 */
EEXCESS.Corpus.prototype.add = function(token, parent) {
    if (typeof this[token] === &#x27;undefined&#x27;) {
        this[token] = {};
        this[token][parent] = 1;
        this[token][&#x27;c&#x27;] = 0;
    } else if (typeof this[token][parent] === &#x27;undefined&#x27;) {
        this[token][parent] = 1;
    } else {
        this[token][parent]++;
    }
    // increment count of all types of this token
    this[token][&#x27;c&#x27;]++;
};

/**
 * Builds a corpus of tokens from the given elements
 * 
 * @param {Array} elements the elements to tokenize (each entry in the array
 * must be an object with structure {text:String,parent:String}
 * @param {String} language country code for language
 * @param {Function} callback callback function to trigger after calculation is
 * finished. The corpus is passed to this function as an argument.
 */
EEXCESS.processElements = function(elements, language, callback) {
    // create tokens from text
    var tokens = [];
    for (var i = 0, len = elements.length; i &lt; len; i++) {
        var t = EEXCESS.tokenize(elements[i].text, elements[i].parent, language);
        tokens = tokens.concat(t);
    }
    // build corpus from tokens
    var corpus = new EEXCESS.Corpus();
    for (var i = 0, len = tokens.length; i &lt; len; i++) {
        // TODO: stem?
        corpus.add(tokens[i].token, tokens[i].parent);
    }
    // callback with corpus
    callback(corpus);
};

// listen for message events
self.addEventListener(&#x27;message&#x27;, function(e) {
    if (e.data.request === &#x27;tokenize&#x27;) {
        EEXCESS.processElements(e.data.elements, e.data.language, self.postMessage);
    }
}, false);

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
